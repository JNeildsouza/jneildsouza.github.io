<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Text Share</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        #password-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        #text-input {
            width: 100%;
            height: 250px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
            font-size: 14px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.danger {
            background-color: #e74c3c;
        }
        button.danger:hover {
            background-color: #c0392b;
        }
        button.success {
            background-color: #2ecc71;
        }
        button.success:hover {
            background-color: #27ae60;
        }
        #output-container {
            margin-top: 20px;
            display: none;
        }
        #share-link {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            box-sizing: border-box;
            background-color: #f5f5f5;
        }
        .notification {
            background-color: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        #text-display {
            width: 100%;
            min-height: 250px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            box-sizing: border-box;
            background-color: #f5f5f5;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            display: none;
        }
        .copy-button {
            background-color: #7f8c8d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        .copy-button:hover {
            background-color: #6c7a7d;
        }
        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        .mode-button {
            background-color: #ecf0f1;
            color: #7f8c8d;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .mode-button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 12px;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        .info-box {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #0d47a1;
        }
        .info-box h3 {
            margin-top: 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <h1>Secure Text Share</h1>
    
    <div class="mode-toggle">
        <button class="mode-button active" id="share-mode-btn" onclick="switchMode('share')">Share Text</button>
        <button class="mode-button" id="view-mode-btn" onclick="switchMode('view')">View Shared Text</button>
    </div>
    
    <div id="share-mode" class="tab-content active">
        <div class="container">
            <h2>Share Text Securely</h2>
            <div class="info-box">
                <h3>How it works</h3>
                <p>This tool lets you share large text securely using client-side encryption. Your text is encrypted with your password and stored locally. Only someone with the link and password can access it.</p>
                <p>The shared URL does not contain the actual data, making it firewall-friendly and discreet.</p>
            </div>
            
            <div class="input-container">
                <input type="text" id="password-input" placeholder="Enter a password for encryption (required)" />
                <textarea id="text-input" placeholder="Type or paste your text here..."></textarea>
            </div>
            
            <div class="controls">
                <button id="encrypt-btn" class="success" onclick="encryptAndStore()">Generate Secure Link</button>
                <button id="clear-btn" class="danger" onclick="clearText()">Clear</button>
            </div>
            
            <div id="output-container">
                <h3>Share this link:</h3>
                <input type="text" id="share-link" readonly />
                <div class="controls">
                    <button class="copy-button" onclick="copyToClipboard('share-link')">Copy Link</button>
                </div>
                <div class="notification" id="copy-notification">Link copied to clipboard!</div>
            </div>
        </div>
    </div>
    
    <div id="view-mode" class="tab-content">
        <div class="container">
            <h2>View Shared Text</h2>
            <div class="info-box">
                <h3>Accessing shared content</h3>
                <p>Enter the password that was used to encrypt the content. If the password is correct, the shared text will be displayed below.</p>
            </div>
            
            <div class="input-container">
                <input type="text" id="decrypt-password" placeholder="Enter the decryption password" />
            </div>
            
            <div class="controls">
                <button class="success" onclick="decryptFromStorage()">Decrypt Text</button>
            </div>
            
            <div class="error" id="error-message"></div>
            
            <div id="text-display"></div>
            <div class="controls" id="copy-text-control" style="display: none;">
                <button class="copy-button" onclick="copyToClipboard('text-display')">Copy Text</button>
                <div class="notification" id="text-copy-notification">Text copied to clipboard!</div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>This tool works entirely in your browser. No data is sent to any server.</p>
    </footer>

    <script>
        // Check if the page is loaded with a key parameter
        window.onload = function() {
            // Get the key from URL if present
            const urlParams = new URLSearchParams(window.location.search);
            const key = urlParams.get('key');
            
            if (key) {
                // Switch to view mode
                switchMode('view');
                // Store the key in sessionStorage for later use
                sessionStorage.setItem('currentKey', key);
            }
        };
        
        function switchMode(mode) {
            // Update button states
            document.getElementById('share-mode-btn').classList.remove('active');
            document.getElementById('view-mode-btn').classList.remove('active');
            document.getElementById(mode + '-mode-btn').classList.add('active');
            
            // Update content visibility
            document.getElementById('share-mode').classList.remove('active');
            document.getElementById('view-mode').classList.remove('active');
            document.getElementById(mode + '-mode').classList.add('active');
        }
        
        function encryptAndStore() {
            const text = document.getElementById('text-input').value;
            const password = document.getElementById('password-input').value;
            
            if (!text.trim()) {
                showError('Please enter some text to share.');
                return;
            }
            
            if (!password.trim()) {
                showError('Please enter a password for encryption.');
                return;
            }
            
            try {
                // Generate a unique key for this content
                const uniqueKey = generateUniqueKey();
                
                // Encrypt the text with the password
                const encryptedText = encryptText(text, password);
                
                // Store the encrypted text in localStorage with the key
                localStorage.setItem('encrypted_' + uniqueKey, encryptedText);
                
                // Create and display the share link
                const shareLink = createShareLink(uniqueKey);
                document.getElementById('share-link').value = shareLink;
                document.getElementById('output-container').style.display = 'block';
                
                // Clear any previous errors
                hideError();
            } catch (error) {
                console.error('Encryption error:', error);
                showError('An error occurred during encryption. Please try again.');
            }
        }
        
        function decryptFromStorage() {
            try {
                // Get the key from sessionStorage
                const uniqueKey = sessionStorage.getItem('currentKey');
                if (!uniqueKey) {
                    showError('No shared content found. Please check the URL.');
                    return;
                }
                
                // Get the password entered by the user
                const password = document.getElementById('decrypt-password').value;
                if (!password.trim()) {
                    showError('Please enter the decryption password.');
                    return;
                }
                
                // Retrieve the encrypted text from localStorage
                const encryptedText = localStorage.getItem('encrypted_' + uniqueKey);
                if (!encryptedText) {
                    showError('The shared content could not be found. It may have been removed or expired.');
                    return;
                }
                
                // Decrypt the text
                const decryptedText = decryptText(encryptedText, password);
                
                // Display the decrypted text
                document.getElementById('text-display').textContent = decryptedText;
                document.getElementById('text-display').style.display = 'block';
                document.getElementById('copy-text-control').style.display = 'block';
                
                // Clear any previous errors
                hideError();
            } catch (error) {
                console.error('Decryption error:', error);
                showError('Failed to decrypt. Please check if the password is correct.');
            }
        }
        
        function generateUniqueKey() {
            // Generate a random key (16 characters)
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let key = '';
            for (let i = 0; i < 16; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return key;
        }
        
        function encryptText(text, password) {
            // Simple XOR encryption (you might want to use a more robust method in production)
            const textBytes = new TextEncoder().encode(text);
            const passwordBytes = new TextEncoder().encode(password);
            const result = new Uint8Array(textBytes.length);
            
            for (let i = 0; i < textBytes.length; i++) {
                result[i] = textBytes[i] ^ passwordBytes[i % passwordBytes.length];
            }
            
            // Convert to base64 for storage
            return btoa(String.fromCharCode.apply(null, result));
        }
        
        function decryptText(encryptedBase64, password) {
            // Decode base64
            const encryptedBytes = new Uint8Array(atob(encryptedBase64).split('').map(char => char.charCodeAt(0)));
            const passwordBytes = new TextEncoder().encode(password);
            const result = new Uint8Array(encryptedBytes.length);
            
            for (let i = 0; i < encryptedBytes.length; i++) {
                result[i] = encryptedBytes[i] ^ passwordBytes[i % passwordBytes.length];
            }
            
            return new TextDecoder().decode(result);
        }
        
        function createShareLink(key) {
            const baseUrl = window.location.href.split('?')[0];
            return `${baseUrl}?key=${key}`;
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            
            if (elementId === 'text-display') {
                // For text display, we need to copy its content
                navigator.clipboard.writeText(element.textContent)
                    .then(() => {
                        showNotification('text-copy-notification');
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                    });
            } else {
                // For input elements
                element.select();
                element.setSelectionRange(0, 99999); // For mobile devices
                
                navigator.clipboard.writeText(element.value)
                    .then(() => {
                        showNotification('copy-notification');
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                        // Fallback
                        document.execCommand('copy');
                        showNotification('copy-notification');
                    });
            }
        }
        
        function showNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }
        
        function clearText() {
            document.getElementById('text-input').value = '';
            document.getElementById('password-input').value = '';
            document.getElementById('output-container').style.display = 'none';
        }
        
        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }
    </script>
</body>
</html>
